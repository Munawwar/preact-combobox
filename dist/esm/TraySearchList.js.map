{
  "version": 3,
  "sources": ["../../lib/TraySearchList.jsx", "../../lib/hooks.js"],
  "sourcesContent": ["import { useCallback, useEffect, useRef, useState } from \"preact/hooks\";\nimport { subscribeToVirtualKeyboard } from \"./hooks.js\";\n\n/**\n * @typedef {import(\"./PreactCombobox-old.js\").Option} Option\n * @typedef {import(\"./PreactCombobox-old.js\").OptionMatch} OptionMatch\n * @typedef {import(\"./PreactCombobox-old.js\").Translations} Translations\n * @typedef {import(\"./PreactCombobox-old.js\").OptionTransformFunction} OptionTransformFunction\n * @typedef {import(\"preact\").VNode} VNode\n */\n\n/**\n * @typedef {Object} TraySearchListProps\n * @property {string} id - Component ID for ARIA attributes\n * @property {boolean} isOpen - Whether the tray is open\n * @property {() => void} onClose - Callback to close the tray\n * @property {string} [trayLabel] - Label for the tray header\n * @property {string} theme - Theme ('light' | 'dark' | 'system')\n * @property {Translations} translations - Translation strings\n * @property {(value: string) => void} onInputChange - Handle input change\n * @property {import(\"preact\").ComponentChildren} children - The AutocompleteList component\n */\n\n/**\n * TraySearchList component - handles mobile tray with search input and options list\n * @param {TraySearchListProps} props\n */\nconst TraySearchList = ({\n  id,\n  isOpen,\n  onClose,\n  trayLabel,\n  theme,\n  translations,\n  onInputChange,\n  children,\n}) => {\n  // Tray-specific state\n  const [trayInputValue, setTrayInputValue] = useState(\"\");\n  const [virtualKeyboardHeight, setVirtualKeyboardHeight] = useState(0);\n  const trayInputRef = useRef(/** @type {HTMLInputElement | null} */ (null));\n  const trayModalRef = useRef(/** @type {HTMLDivElement | null} */ (null));\n  const originalOverflowRef = useRef(\"\");\n  const virtualKeyboardHeightAdjustSubscription = useRef(/** @type {function | null} */ (null));\n\n  // Handle tray input change\n  const handleTrayInputChange = useCallback(\n    /**\n     * @param {import('preact/compat').ChangeEvent<HTMLInputElement>} e\n     */\n    (e) => {\n      const value = e.currentTarget.value;\n      setTrayInputValue(value);\n      onInputChange(value);\n    },\n    [onInputChange],\n  );\n\n  // Handle tray close\n  const handleClose = useCallback(() => {\n    setTrayInputValue(\"\");\n    setVirtualKeyboardHeight(0);\n    virtualKeyboardHeightAdjustSubscription.current?.();\n    virtualKeyboardHeightAdjustSubscription.current = null;\n\n    // Restore original overflow\n    const scrollingElement = /** @type {HTMLElement} */ (\n      document.scrollingElement || document.documentElement\n    );\n    scrollingElement.style.overflow = originalOverflowRef.current;\n\n    onClose();\n  }, [onClose]);\n\n  // Setup virtual keyboard subscription and overflow handling when tray opens\n  useEffect(() => {\n    if (isOpen) {\n      // Get the scrolling element (body or html)\n      const scrollingElement = /** @type {HTMLElement} */ (\n        document.scrollingElement || document.documentElement\n      );\n\n      // Save original overflow and apply hidden\n      originalOverflowRef.current = scrollingElement.style.overflow;\n      scrollingElement.style.overflow = \"hidden\";\n\n      // Subscribe to virtual keyboard for tray\n      if (!virtualKeyboardHeightAdjustSubscription.current) {\n        virtualKeyboardHeightAdjustSubscription.current = subscribeToVirtualKeyboard({\n          heightCallback(keyboardHeight, isVisible) {\n            setVirtualKeyboardHeight(isVisible ? keyboardHeight : 0);\n          },\n        });\n      }\n\n      // Focus the input when tray opens\n      trayInputRef.current?.focus();\n    }\n  }, [isOpen]);\n\n  // Clean up when component unmounts or tray closes\n  useEffect(() => {\n    return () => {\n      if (virtualKeyboardHeightAdjustSubscription.current) {\n        virtualKeyboardHeightAdjustSubscription.current();\n        virtualKeyboardHeightAdjustSubscription.current = null;\n      }\n    };\n  }, []);\n\n  // Children contains the SearchableList component\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    // I couldn't use native <dialog> element because trying to focus input right\n    // after dialog.close() doesn't seem to work on Chrome (Android).\n    <div\n      ref={trayModalRef}\n      className={`PreactCombobox-modal ${`PreactCombobox--${theme}`}`}\n      style={{ display: isOpen ? null : \"none\" }}\n      onClick={(e) => {\n        // Close modal when clicking backdrop\n        if (e.target === trayModalRef.current) {\n          handleClose();\n        }\n      }}\n      onKeyDown={(e) => {\n        if (e.key === \"Escape\") {\n          handleClose();\n        }\n      }}\n      // biome-ignore lint/a11y/useSemanticElements: Custom modal implementation instead of dialog element\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby={trayLabel ? `${id}-tray-label` : undefined}\n      tabIndex={-1}\n    >\n      <div className={`PreactCombobox-tray ${`PreactCombobox--${theme}`}`}>\n        <div className=\"PreactCombobox-trayHeader\">\n          {trayLabel && (\n            <label\n              id={`${id}-tray-label`}\n              className=\"PreactCombobox-trayLabel\"\n              htmlFor={`${id}-tray-input`}\n            >\n              {trayLabel}\n            </label>\n          )}\n          <input\n            id={`${id}-tray-input`}\n            ref={trayInputRef}\n            type=\"text\"\n            value={trayInputValue}\n            placeholder={translations.searchPlaceholder}\n            onChange={handleTrayInputChange}\n            onKeyDown={(e) => {\n              if (e.key === \"Escape\") {\n                handleClose();\n              }\n            }}\n            className={`PreactCombobox-trayInput ${!trayLabel ? \"PreactCombobox-trayInput--noLabel\" : \"\"}`}\n            role=\"combobox\"\n            aria-expanded=\"true\"\n            aria-haspopup=\"listbox\"\n            aria-controls={`${id}-options-listbox`}\n            aria-label={trayLabel || translations.searchPlaceholder}\n            autoComplete=\"off\"\n          />\n        </div>\n        {children}\n        {virtualKeyboardHeight > 0 && (\n          <div\n            className=\"PreactCombobox-virtualKeyboardSpacer\"\n            style={{ height: `${virtualKeyboardHeight}px` }}\n            aria-hidden=\"true\"\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TraySearchList;", "import { useCallback, useMemo, useRef, useState } from \"preact/hooks\";\n\nexport function isEqual(value1, value2) {\n  // Handle circular references using WeakMap\n  const seenA = new WeakMap();\n  const seenB = new WeakMap();\n\n  function deepCompare(a, b) {\n    // Handle primitives\n    if (Object.is(a, b)) return true;\n    if (a === null || b === null || typeof a !== \"object\" || typeof b !== \"object\") {\n      return a === b;\n    }\n\n    // Handle React/JSX elements - direct reference comparison since they're immutable\n    // This prevents unnecessary deep comparisons\n    if (a.$$typeof === Symbol.for(\"react.element\") || b.$$typeof === Symbol.for(\"react.element\")) {\n      return a === b;\n    }\n\n    // Handle different types\n    if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\n      return false;\n    }\n\n    // Check for circular references\n    if (seenA.has(a)) return seenA.get(a) === b;\n    if (seenB.has(b)) return seenB.get(b) === a;\n    // detect cross object circular references\n    if (seenA.has(b) || seenB.has(a)) return false;\n    seenA.set(a, b);\n    seenB.set(b, a);\n\n    // Handle Arrays\n    if (Array.isArray(a)) {\n      if (a.length !== b.length) {\n        return false;\n      }\n      return a.every((item, index) => deepCompare(item, b[index]));\n    }\n\n    // Handle Dates\n    if (a instanceof Date) {\n      return a.getTime() === b.getTime();\n    }\n\n    // Handle RegExp\n    if (a instanceof RegExp) {\n      return a.toString() === b.toString();\n    }\n\n    // Handle Objects\n    const keysA = Object.keys(a);\n    const keysB = Object.keys(b);\n\n    if (keysA.length !== keysB.length) return false;\n\n    return keysA.every((key) => keysB.includes(key) && deepCompare(a[key], b[key]));\n  }\n\n  return deepCompare(value1, value2);\n}\n\n/**\n * Both dependencies and state are compared using a deep equality function.\n * @template T\n * @param {T} newState\n * @returns {T}\n */\nexport function useDeepMemo(newState) {\n  const state = useRef(/** @type {T} */ (null));\n  if (!isEqual(newState, state.current)) {\n    state.current = newState;\n  }\n  return state.current;\n}\n\n/**\n * @template T\n * @param {T} initialValue\n * @returns {[() => T, (value: T) => void, boolean]}\n */\nexport function useLive(initialValue) {\n  const [refreshValue, forceRefresh] = useState(0);\n  const ref = useRef(initialValue);\n\n  // refreshValue is used to create a new getter so that any useEffect etc that depends on it will be re-run\n  // In addition, provide `hasValueChanged` to help detect in a multi-dependency useEffect whether this specific\n  // state has changed.\n  let hasValueChanged = false;\n  // biome-ignore lint/correctness/useExhaustiveDependencies: explanation above\n  const getValue = useMemo(() => {\n    hasValueChanged = true;\n    return () => ref.current;\n  }, [refreshValue]);\n\n  // setter doesn't need to be created on every render\n  const setValue = useCallback((value) => {\n    if (value !== ref.current) {\n      ref.current = value;\n      forceRefresh((x) => x + 1);\n    }\n  }, []);\n\n  return [getValue, setValue, hasValueChanged];\n}\n\nconst isTouchDevice =\n  typeof window !== \"undefined\" && window.matchMedia?.(\"(pointer: coarse)\")?.matches;\n// Since page hasn't potentially fully loaded yet we get only an approximate height\nlet visualViewportInitialHeight = window.visualViewport?.height ?? 0;\n\n/**\n * Subscribe to virtual keyboard visibility changes (touch devices only)\n * @param {Object} params - Parameters for subscribing to virtual keyboard\n * @param {function(boolean): void} [params.visibleCallback] - Called with boolean when keyboard visibility changes\n * @param {function(number, boolean): void} [params.heightCallback] - Called with keyboard height when keyboard height changes\n * @returns {function | null} - Unsubscribe function\n */\nexport function subscribeToVirtualKeyboard({ visibleCallback, heightCallback }) {\n  if (!isTouchDevice || typeof window === \"undefined\" || !window.visualViewport) return null;\n\n  let isVisible = false;\n  const handleViewportResize = () => {\n    if (!window.visualViewport) return;\n    const heightDiff = visualViewportInitialHeight - window.visualViewport.height;\n    const isVisibleNow = heightDiff > 150;\n    if (isVisible !== isVisibleNow) {\n      isVisible = isVisibleNow;\n      visibleCallback?.(isVisible);\n    }\n    heightCallback?.(heightDiff, isVisible);\n  };\n  window.visualViewport.addEventListener(\"resize\", handleViewportResize, { passive: true });\n  return () => {\n    window.visualViewport?.removeEventListener(\"resize\", handleViewportResize);\n  };\n}\n"],
  "mappings": "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",
  "names": ["useCallback", "useRef", "useState", "useState", "useRef", "useCallback"]
}
